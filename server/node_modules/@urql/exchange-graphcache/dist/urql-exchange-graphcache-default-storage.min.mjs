import{_ as e}from"./08e6d3e1.min.mjs";function n(e){return new Promise((function(n,t){e.onerror=function(){t(e.error)},e.onsuccess=function(){n(e.result)}}))}function t(e){return new Promise((function(n,t){e.onerror=function(){t(e.error)},e.oncomplete=n}))}function r(r){var o;r||(r={});var u=r.idbName||"graphcache-v4",c="entries",i="metadata",a=Object.create(null),f=Math.floor((new Date).valueOf()/864e5),s=f-(r.maxAge||7),l=indexedDB.open(u,1),d=n(l);function v(e){return e.replace(/:/g,"%3a")}function h(e){return e.replace(/%3a/g,":")}function p(e){for(var n={},t="",r="",o="",u=0,c=0;c<e.length;){for(o="";":"!==(t=e[c++])&&t;)o+=t;u?(n[r]=h(o)||void 0,u=0):(r=h(o),u=1)}return n}return l.onupgradeneeded=function(){l.result.createObjectStore(c),l.result.createObjectStore(i)},{clear:function(){return d.then((function(e){var n=e.transaction([i,c],"readwrite");return n.objectStore(i).clear(),n.objectStore(c).clear(),a=Object.create(null),t(n)}))},readMetadata:function(){return d.then((function(e){return n(e.transaction(i,"readonly").objectStore(i).get(i))}),(function(){return null}))},writeMetadata:function(e){d.then((function(t){return n(t.transaction(i,"readwrite").objectStore(i).put(e,i))}),(function(){}))},writeData:function(t){e(a,t);var r=function(){};return d.then((function(e){return n(e.transaction(c,"readwrite").objectStore(c).put(function(){var e="";for(var n in a){var t=a[n];e+=v(n),e+=":",t&&(e+=v(t)),e+=":"}return e}(),f))})).then(r,r)},readData:function(){var n=[];return d.then((function(r){var o=r.transaction(c,"readwrite"),u=o.objectStore(c);return(u.openKeyCursor||u.openCursor).call(u).onsuccess=function(){if(this.result){var t=this.result.key;if("number"!=typeof t||t<s)u.delete(t);else{var r=u.get(t),o=n.length;n.push(""),r.onsuccess=function(){var u=""+r.result;t===f&&e(a,p(u)),n[o]=u}}this.result.continue()}},t(o)})).then((function(){return p(n.join(""))}),(function(){return a}))},onOnline:function(e){o&&(window.removeEventListener("online",o),o=void 0),window.addEventListener("online",o=function(){e()})}}}export{r as makeDefaultStorage};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.mjs.map
