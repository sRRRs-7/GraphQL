import{stringifyVariables as e,createRequest as r,formatDocument as t,makeOperation as n}from"@urql/core";import{share as i,merge as a,mergeMap as o,fromArray as u,buffer as s,fromPromise as l,skipUntil as f,map as c,filter as d,empty as p,makeSubject as v,tap as y}from"wonka";import{_ as m}from"./08e6d3e1.min.mjs";import{Kind as h}from"graphql/language/kinds.mjs";import{valueFromASTUntyped as k}from"graphql/utilities/valueFromASTUntyped.mjs";import{print as g}from"graphql/language/printer.mjs";function _(e){return e.name.value}function O(e){return e.typeCondition.name.value}function b(e){return e.alias?e.alias.value:_(e)}function w(e){return e.selectionSet?e.selectionSet.selections:[]}function q(e){return e.typeCondition?_(e.typeCondition):null}function N(e){return e.kind===h.FIELD}function E(e){return e.kind===h.INLINE_FRAGMENT}function K(e,r){var t={},n=0;if(e.arguments&&e.arguments.length)for(var i=0,a=e.arguments.length;i<a;i++){var o=e.arguments[i],u=k(o.value,r);null!=u&&(t[_(o)]=u,n++)}return n>0?t:null}function x(e,r){if(r&&e.variableDefinitions){for(var t={},n=0,i=e.variableDefinitions.length;n<i;n++){var a=_(e.variableDefinitions[n].variable);t[a]=r[a]}return t}}function A(e,r){var t={};if(!r)return t;if(e.variableDefinitions)for(var n=0,i=e.variableDefinitions.length;n<i;n++){var a=e.variableDefinitions[n],o=_(a.variable);t[o]=void 0===r[o]&&a.defaultValue?k(a.defaultValue,r):r[o]}for(var u in r)u in t||(t[u]=r[u]);return t}function S(e,r,t){if(!e){var n=new Error((r||"Minfied Error #"+t+"\n")+"\nhttps://bit.ly/2XbVrpR#"+t);throw n.name="Graphcache Error",n}}function T(e){for(var r=0;r<e.definitions.length;r++)if(e.definitions[r].kind===h.OPERATION_DEFINITION)return e.definitions[r];S(!1,"",1)}function M(e){for(var r={},t=0;t<e.definitions.length;t++){var n=e.definitions[t];n.kind===h.FRAGMENT_DEFINITION&&(r[_(n)]=n)}return r}function L(e,r){for(var t=0;e.directives&&t<e.directives.length;t++){var n=e.directives[t],i=_(n);if(("include"===i||"skip"===i)&&n.arguments&&n.arguments[0]&&"if"===_(n.arguments[0])){var a=k(n.arguments[0].value,r);return"include"===i?!!a:!a}}return!0}function F(e,r){for(var t=0;e.directives&&t<e.directives.length;t++){var n=e.directives[t];if("defer"===_(n)){for(var i=0;n.arguments&&i<n.arguments.length;i++){var a=n.arguments[t];if("if"===_(a))return!!k(a.value,r)}return!0}}return!1}function I(e,r,t){var n=j(e,r,t);return!!n&&"NON_NULL"!==n.type.kind}function C(e,r,t){var n=j(e,r,t);if(!n)return!1;var i="NON_NULL"===n.type.kind?n.type.ofType:n.type;return"LIST"===i.kind&&"NON_NULL"!==i.ofType.kind}function D(e,r,t){if(!t)return!1;var n=q(r);return!n||t===n||(e.types[n]&&"OBJECT"===e.types[n].kind?n===t:(function(e,r){S(e.types[r]&&("INTERFACE"===e.types[r].kind||"UNION"===e.types[r].kind),"",5)}(e,n),P(e,t),e.isSubType(n,t)))}function j(e,r,t){if(0!==t.indexOf("__")&&0!==r.indexOf("__"))return P(e,r),e.types[r].fields[t]}function P(e,r){S(e.types[r]&&"OBJECT"===e.types[r].kind,"",3)}function R(r,t){return t?r+"("+e(t)+")":r}function J(e,r){return e+"."+r}function Q(e){var r=e.indexOf("(");return r>-1?{fieldKey:e,fieldName:e.slice(0,r),arguments:JSON.parse(e.slice(r+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}}function U(e){var r=e.indexOf(".");return{entityKey:e.slice(0,r).replace(/%2e/g,"."),fieldKey:e.slice(r+1)}}function B(){return Object.create(null)}new Set;var G=null,V=null,z=null,W=null,X=null,H=null,Y=!1;function Z(){return{optimistic:B(),base:new Map}}function $(e){var r;if(e){if(G.has(e))return e;r=V.get(e)||m({},e),V.set(e,r)}else r={};return G.add(r),r}function ee(e){return!!e&&G.has(e)}function re(e,r,t,n){G=new Set,V=new Map,z=e,W=r,X=B(),Y=!!n,t?"read"===z?H=t:n||r.optimisticOrder.length>1?(n||r.commutativeKeys.has(t)?n&&r.commutativeKeys.delete(t):he(r,t),H=t,function(e,r){-1===e.optimisticOrder.indexOf(r)&&e.optimisticOrder.unshift(r),e.refLock[r]||(e.refLock[r]=B(),e.links.optimistic[r]=new Map,e.records.optimistic[r]=new Map)}(r,t)):(H=null,ge(r,t)):H=null}function te(){var r=W,t=H;if(Y=!1,H=null,t&&r.optimisticOrder.indexOf(t)>-1)for(var n=r.optimisticOrder.length;--n>=0&&r.refLock[r.optimisticOrder[n]]&&r.commutativeKeys.has(r.optimisticOrder[n])&&!r.deferredKeys.has(r.optimisticOrder[n]);)_e(r.optimisticOrder[n]);G=null,V=null,z=null,W=null,X=null,r.defer||(r.defer=!0,Promise.resolve().then((function(){re("read",r,null),W.gc.forEach((function(e,r,t){if((W.refCount[e]||0)>0)t.delete(e);else{for(var n in W.refLock){var i=W.refLock[n];if((i[e]||0)>0)return;delete i[e]}delete W.refCount[e],t.delete(e),W.records.base.delete(e);var a=W.links.base.get(e);if(a)for(var o in W.links.base.delete(e),a)se(t,W.refCount,a[o],-1)}})),function(){if(W.storage){Y=!0,z="read";var r=B();W.persist.forEach((function(t){var n,i=U(t),a=i.entityKey,o=i.fieldKey;r[t]=void 0!==(n=ve(a,o))?":"+e(n):void 0!==(n=pe(a,o))?e(n):void 0})),Y=!1,W.storage.writeData(r),W.persist.clear()}}(),te(),r.defer=!1})))}function ne(e,r,t){r&&!t&&e.deferredKeys.delete(r),re("write",e,r,t),te()}function ie(){return S(null!==X,"",2),X}function ae(e,r,t,n){var i=H?e.optimistic[H]:e.base,a=i.get(r);void 0===a&&i.set(r,a=B()),void 0!==n||H?a[t]=n:delete a[t]}function oe(e,r,t){for(var n,i=!Y&&"read"===z&&H&&W.commutativeKeys.has(H),a=0,o=W.optimisticOrder.length;a<o;a++){var u=W.optimisticOrder[a],s=e.optimistic[u];if(i=i&&u!==H,s&&(!i||!W.commutativeKeys.has(u))&&(!Y||"write"===z||W.commutativeKeys.has(u))&&void 0!==(n=s.get(r))&&t in n)return n[t]}return void 0!==(n=e.base.get(r))?n[t]:void 0}function ue(e,r,t,n){var i=void 0!==r[t]?r[t]:0,a=r[t]=i+n|0;void 0!==e&&(a<=0?e.add(t):i<=0&&a>0&&e.delete(t))}function se(e,r,t,n){if("string"==typeof t)ue(e,r,t,n);else if(Array.isArray(t))for(var i=0,a=t.length;i<a;i++)Array.isArray(t[i])?se(e,r,t[i],n):t[i]&&ue(e,r,t[i],n)}function le(e,r,t){if(void 0!==t)for(var n in t)r.has(n)||(e.push(Q(n)),r.add(n))}function fe(e,r,t,n){le(e,r,n.base.get(t));for(var i=0,a=W.optimisticOrder.length;i<a;i++){var o=n.optimistic[W.optimisticOrder[i]];void 0!==o&&le(e,r,o.get(t))}}function ce(e,r){"__typename"!==r&&(e!==W.queryRootKey?X[e]=!0:void 0!==r&&(X[J(e,r)]=!0))}function de(e,r){!Y&&W.storage&&W.persist.add(function(e,r){return e.replace(/\./g,"%2e")+"."+r}(e,r))}function pe(e,r){return ce(e,r),oe(W.records,e,r)}function ve(e,r){return ce(e,r),oe(W.links,e,r)}function ye(e,r,t){ce(e,r),de(e,r),ae(W.records,e,r,t)}function me(e,r,t){var n,i,a,o=W;H?(n=o.refLock[H]||(o.refLock[H]=B()),i=o.links.optimistic[H]):(n=o.refCount,i=o.links.base,a=o.gc);var u=i&&i.get(e),s=u&&u[r];ce(e,r),de(e,r),ae(o.links,e,r,t),se(a,n,s,-1),se(a,n,t,1)}function he(e,r,t){t?e.deferredKeys.add(r):e.deferredKeys.delete(r);var n=e.optimisticOrder.indexOf(r);if(n>-1){if(!t&&e.commutativeKeys.has(r))return;e.optimisticOrder.splice(n,1),ke(e,r)}for(n=0;t&&n<e.optimisticOrder.length&&!e.deferredKeys.has(e.optimisticOrder[n])&&(!e.refLock[e.optimisticOrder[n]]||!e.commutativeKeys.has(e.optimisticOrder[n]));n++);e.optimisticOrder.splice(n,0,r),e.commutativeKeys.add(r)}function ke(e,r){e.refLock[r]&&(delete e.refLock[r],delete e.records.optimistic[r],delete e.links.optimistic[r],e.deferredKeys.delete(r))}function ge(e,r){var t=e.optimisticOrder.indexOf(r);t>-1&&(e.optimisticOrder.splice(t,1),e.commutativeKeys.delete(r)),ke(e,r)}function _e(e){var r=X;X=B();var t=W.links.optimistic[e];t&&t.forEach((function(e,r){for(var t in e)me(r,t,e[t])}));var n=W.records.optimistic[e];n&&n.forEach((function(e,r){for(var t in e)ye(r,t,e[t])})),X=r,ge(W,e)}function Oe(e){var r=W.links,t=W.records,n=[],i=new Set;return ce(e),fe(n,i,e,r),fe(n,i,e,t),n}var be={current:null},we={current:!1};function qe(e){return e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0}function Ne(e,r,t,n,i,a,o){var u={store:e,variables:r,fragments:t,parent:{__typename:n},parentTypeName:n,parentKey:i,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,optimistic:!!a,__internal:{path:[],errorMap:void 0}};if(o&&o.graphQLErrors)for(var s=0;s<o.graphQLErrors.length;s++){var l=o.graphQLErrors[s];l.path&&l.path.length&&(u.__internal.errorMap||(u.__internal.errorMap=Object.create(null)),u.__internal.errorMap[l.path.join(".")]=l)}return u}function Ee(e,r,t,n,i,a){be.current=e,e.parent=r,e.parentTypeName=t,e.parentKey=n,e.parentFieldKey=i,e.fieldName=a,e.error=qe(e)}function Ke(e,r,t,n){if(!r)return!1;var i=q(e);return!i||r===i||"write"===z||!w(e).some((function(e){if(!N(e))return!1;var r=R(_(e),K(e,n));return!function(e,r){return void 0!==pe(e,r)||void 0!==ve(e,r)}(t,r)}))}function xe(e,r,t,n){var i,a=!1,o=0;return function(){if(!we.current&&a&&(we.current=a),i){var u=i();if(null!=u)return u;i=void 0,a=!1}for(;o<t.length;){var s=t[o++];if(L(s,n.variables)){if(N(s))return s;var l=E(s)?s:n.fragments[_(s)];if(void 0!==l&&(n.store.schema?D(n.store.schema,l,e):Ke(l,e,r,n.variables)))return a=!!F(s,n.variables),!we.current&&a&&(we.current=a),(i=xe(e,r,w(l),n))()}}}}function Ae(e){return null==e?null:e}function Se(e,r){if(null==r)return r;if(Array.isArray(r)){for(var t=new Array(r.length),n=0,i=t.length;n<i;n++)t[n]=Se(e,r[n]);return t}return e.keyOfEntity(r)}function Te(e,r,t,n,i){re("write",e.data,i||null);var a=Me(e,r,t,n);return te(),a}function Me(e,r,t,n,i){var a=T(r.query),o={data:t,dependencies:ie()},u=e.rootFields[a.operation];return Le(Ne(e,A(a,r.variables),M(r.query),u,u,!!i,n),u,w(a),t),o}function Le(e,r,t,n){var i=r===e.store.rootFields.query,a=!i&&!!e.store.rootNames[r],o=a||i?r:n.__typename;if(o){a||i||!r||ye(r,"__typename",o);for(var u,s=xe(o,r||o,t,e);u=s();){var l=_(u),f=K(u,e.variables),c=R(l,f),d=b(u),p=n[d];if(!("__typename"===l||void 0===p&&we.current)){if(e.__internal.path.push(d),e.optimistic&&a){var v=e.store.optimisticMutations[l];if(!v)continue;Ee(e,n,o,o,c,l),p=n[d]=Ae(v(f||{},e.store,e))}if(u.selectionSet)if(r&&!a){var y=J(r,c);me(r||o,c,Fe(e,w(u),Ae(p),y))}else Fe(e,w(u),Ae(p));else r&&!a&&ye(r||o,c,null===p&&qe(e)?void 0:p);if(a){var m=e.store.updates[o][l];m&&(Ee(e,n,o,o,J(o,c),l),n[l]=p,m(n,f||{},e.store,e))}e.__internal.path.pop()}}}}function Fe(e,r,t,n){if(Array.isArray(t)){for(var i=new Array(t.length),a=0,o=t.length;a<o;a++){e.__internal.path.push(a);var u=n?J(n,""+a):void 0,s=Fe(e,r,t[a],u);i[a]=s,e.__internal.path.pop()}return i}if(null===t)return qe(e)?void 0:null;var l=e.store.keyOfEntity(t)||n;return Le(e,l,r,t),l||null}function Ie(e){var r,t;this.keyOfField=R,this.resolveFieldByKey=this.resolve,e||(e={}),this.resolvers=e.resolvers||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{};var n,i="Query",a="Mutation",o="Subscription";if(e.schema){var u=function(e){var r=e.__schema,t={};function n(e){for(var r={},t=0;t<e.length;t++)r[e[t].name]=e[t];return r}function i(e){switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:n(e.interfaces||[]),fields:n(e.fields.map((function(e){return{name:e.name,type:e.type,args:n(e.args)}})))};case"UNION":return{name:e.name,kind:e.kind,types:n(e.possibleTypes||[])}}}var a={query:r.queryType?r.queryType.name:null,mutation:r.mutationType?r.mutationType.name:null,subscription:r.subscriptionType?r.subscriptionType.name:null,types:void 0,isSubType:function(e,r){var n=t[e],i=t[r];return!!(n&&i&&("UNION"===n.kind?n.types[r]:"OBJECT"!==n.kind&&"OBJECT"===i.kind?i.interfaces[e]:e===r))}};if(r.types){a.types=t;for(var o=0;o<r.types.length;o++){var u=r.types[o];if(u&&u.name){var s=i(u);s&&(t[u.name]=s)}}}return a}(e.schema);i=u.query||i,a=u.mutation||a,o=u.subscription||o,u.types&&(this.schema=u)}this.updates=((r={})[a]=e.updates&&e.updates.Mutation||{},r[o]=e.updates&&e.updates.Subscription||{},r),this.rootFields={query:i,mutation:a,subscription:o},this.rootNames=((t={})[i]="query",t[a]="mutation",t[o]="subscription",t),this.data=(n=i,{defer:!1,gc:new Set,persist:new Set,queryRootKey:n,refCount:B(),refLock:B(),links:Z(),records:Z(),deferredKeys:new Set,commutativeKeys:new Set,optimisticOrder:[],storage:null})}function Ce(e,r,t,n,i){re("read",e.data,i);var a=De(e,r,t,n);return te(),a}function De(e,r,t,n){var i=T(r.query),a=e.rootFields[i.operation],o=w(i),u=Ne(e,A(i,r.variables),M(r.query),a,a,!1,n);t||(t=$());var s=a!==u.store.rootFields.query?je(u,a,o,t):Re(u,a,o,t);return{dependencies:ie(),partial:u.partial||!s,data:s||null}}function je(e,r,t,n){if("string"!=typeof(e.store.rootNames[r]?r:n.__typename))return n;for(var i,a=xe(r,r,t,e),o=!1,u=$(n);i=a();){var s,l=b(i),f=n[l];e.__internal.path.push(l),s=i.selectionSet&&null!==f?Pe(e,w(i),Ae(f)):f,o=o||s!==f,void 0!==s&&(u[l]=s),e.__internal.path.pop()}return o?u:n}function Pe(e,r,t){if(Array.isArray(t)){for(var n=new Array(t.length),i=!1,a=0,o=t.length;a<o;a++)e.__internal.path.push(a),n[a]=Pe(e,r,t[a]),i=i||n[a]!==t[a],e.__internal.path.pop();return i?n:t}if(null===t)return null;var u=e.store.keyOfEntity(t);return null!==u?Re(e,u,r,t)||null:je(e,t.__typename,r,t)}function Re(e,r,t,n,i){var a=e.store,o=r===a.rootFields.query,u=i&&a.keyOfEntity(i)||r,s=o?r:pe(u,"__typename")||i&&i.__typename;if("string"==typeof s&&(!i||s===i.__typename)){for(var l,f=xe(s,u,t,e),c=!1,d=!1,p=s!==n.__typename,v=$(n);void 0!==(l=f());){var y=_(l),m=K(l,e.variables),h=b(l),k=R(y,m),g=J(u,k),O=pe(u,k),q=i?i[y]:void 0,N=a.resolvers[s];e.__internal.path.push(h);var E=void 0;if("__typename"===y)E=s;else if(void 0!==q&&void 0===l.selectionSet)E=q;else if("read"===(S(null!==z,"",2),z)&&N&&"function"==typeof N[y]){if(Ee(e,v,s,u,g,y),void 0!==O&&(v[h]=O),E=N[y](v,m||{},a,e),l.selectionSet&&(E=Je(e,s,y,g,w(l),void 0!==v[h]?v[h]:n[h],E,ee(n))),a.schema&&null===E&&!I(a.schema,s,y))return}else if(l.selectionSet)if(void 0!==q)E=Je(e,s,y,g,w(l),void 0!==v[h]?v[h]:n[h],q,ee(n));else{var x=ve(u,k);void 0!==x?E=Qe(e,x,s,y,w(l),void 0!==v[h]?v[h]:n[h],ee(n)):"object"==typeof O&&null!==O&&(E=O)}else E=O;if(void 0===E&&we.current)c=!0;else if(void 0===E&&(a.schema&&I(a.schema,s,y)||qe(e)))d=!0,E=null;else{if(void 0===E)return void e.__internal.path.pop();c=c||"__typename"!==y}e.__internal.path.pop(),p=p||E!==n[h],void 0!==E&&(v[h]=E)}return e.partial=e.partial||d,o&&d&&!c?void 0:p?v:n}}function Je(e,r,t,n,i,a,o,u){if(Array.isArray(o)){for(var s=e.store,l=!!s.schema&&C(s.schema,r,t),f=new Array(o.length),c=!Array.isArray(a)||o.length!==a.length,d=0,p=o.length;d<p;d++){e.__internal.path.push(d);var v=Je(e,r,t,J(n,""+d),i,null!=a?a[d]:void 0,o[d],u);if(e.__internal.path.pop(),void 0===v&&!l)return;e.partial=e.partial||void 0===v&&l,f[d]=null!=v?v:null,c=c||f[d]!==a[d]}return c?f:a}if(null==o)return o;if(u&&null===a)return null;if("string"==typeof(m=o)||"object"==typeof m&&"string"==typeof m.__typename){var y=a||$();return"string"==typeof o?Re(e,o,i,y):Re(e,n,i,y,o)}var m}function Qe(e,r,t,n,i,a,o){if(Array.isArray(r)){for(var u=e.store,s=!!u.schema&&C(u.schema,t,n),l=new Array(r.length),f=!Array.isArray(a)||l.length!==a.length,c=0,d=r.length;c<d;c++){e.__internal.path.push(c);var p=Qe(e,r[c],t,n,i,null!=a?a[c]:void 0,o);if(e.__internal.path.pop(),void 0===p&&!s)return;e.partial=e.partial||void 0===p&&s,l[c]=p||null,f=f||l[c]!==a[c]}return f?l:a}return null===r||null===a&&o?null:Re(e,r,i,a||$())}function Ue(e,r){return n(e.kind,e,m({},e.context,{meta:m({},e.context.meta,{cacheOutcome:r})}))}function Be(e,r){return n(e.kind,e,m({},e.context,{requestPolicy:r}))}function Ge(e){return function(r){var v,y=r.forward,m=r.client,h=new Ie(e);e&&e.storage&&(v=e.storage.readData().then((function(r){!function(e,r,t){for(var n in re("write",e,null),t){var i=t[n];if(void 0!==i){var a=U(n),o=a.entityKey,u=a.fieldKey;":"===i[0]?me(o,u,JSON.parse(i.slice(1))):ye(o,u,JSON.parse(i))}}te(),e.storage=r}(h.data,e.storage,r)})));var k=new Map,g=[],_=new Map,O=new Map,b=B(),w=new Set,q=B();function N(e){for(var r in e)if(b[r])return!0;return!1}function E(e,r){if(r)for(var t in r){var n=q[t];if(n){q[t]=[];for(var i=0,a=n.length;i<a;i++)e.add(n[i])}}}function K(e,r){r.forEach((function(r){if(r!==e.key){var t=_.get(r);if(t){_.delete(r);var n="cache-first";w.has(r)&&(w.delete(r),n="cache-and-network"),m.reexecuteOperation(Be(t,n))}}}))}function A(e){if("query"===e.kind)he(h.data,e.key);else if("teardown"===e.kind)_.delete(e.key),O.delete(e.key),ne(h.data,e.key);else if("mutation"===e.kind&&"network-only"!==e.context.requestPolicy){var r=function(e,r,t){re("write",e.data,t,!0);var n=Me(e,r,{},void 0,!0);return te(),n}(h,e,e.key).dependencies;if(!function(e){for(var r in e)return!1;return!0}(r)){for(var i in r)b[i]=!0;k.set(e.key,r);var a=new Set;E(a,r),K(e,a)}}return n(e.kind,{key:e.key,query:t(e.query),variables:e.variables?x(T(e.query),e.variables):e.variables},e.context)}function S(e,r){for(var t in r)(q[t]||(q[t]=[])).push(e.key),_.set(e.key,e)}function M(e){var r=Ce(h,e,O.get(e.key)),t=r.data?r.partial?"partial":"hit":"miss";return O.set(e.key,r.data),S(e,r.dependencies),{outcome:t,operation:e,data:r.data,dependencies:r.dependencies}}function L(e,r){var t,n=e.operation,i=e.error,a=e.extensions,o=n.key;"mutation"===n.kind&&(E(r,k.get(o)),k.delete(o)),he(h.data,n.key,"subscription"===n.kind||e.hasNext);var u=e.data;if(u){E(r,Te(h,n,u,e.error,o).dependencies);var s=Ce(h,n,"query"===n.kind&&O.get(n.key)||u,e.error,o);u=s.data,"query"===n.kind&&(E(r,t=s.dependencies),O.set(n.key,e.data))}else ne(h.data,n.key);return t&&S(e.operation,t),{data:u,error:i,extensions:a,operation:n}}return function(e){var r=i(e),t=v?i(a([o(u)(s(l(v))(r)),f(l(v))(r)])):r,n=i(c(M)(d((function(e){return"query"===e.kind&&"network-only"!==e.context.requestPolicy}))(t))),_=d((function(e){return"query"!==e.kind||"network-only"===e.context.requestPolicy}))(t),O=c((function(e){return Ue(e.operation,"miss")}))(d((function(e){return"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!N(e.dependencies)}))(n)),q=c((function(e){var r=e.operation,t=e.outcome,n=e.dependencies,i={operation:Ue(r,t),data:e.data,error:e.error,extensions:e.extensions};return("cache-and-network"===r.context.requestPolicy||"cache-first"===r.context.requestPolicy&&"partial"===t)&&(i.stale=!0,N(n)?"cache-and-network"===r.context.requestPolicy&&w.add(r.key):m.reexecuteOperation(Be(r,"network-only"))),i}))(d((function(e){return"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy}))(n)),E=i(y(c(A)(a([_,O])))),x=c((function(e){var r=new Set,t=L(e,r);return K(e.operation,r),t}))(d((function(e){return!k.has(e.operation.key)}))(E)),S=o((function(e){if(g.push(e)<k.size)return p;for(var r=0;r<g.length;r++)he(h.data,g[r].operation.key);for(var t in b)delete b[t];for(var n,i=[],a=new Set;n=g.shift();)i.push(L(n,a));return K(e.operation,a),u(i)}))(d((function(e){return k.has(e.operation.key)}))(E));return a([x,S,q])}}}function Ve(e){return e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message))}function ze(e){return function(t){var o=e.storage;if(o&&o.onOnline&&o.readMetadata&&o.writeMetadata){var u=t.forward,s=t.client,l=t.dispatchDebug,f=v(),c=f.source,p=f.next,m=e.optimistic||{},h=[],k=function(){for(var e=[],r=0;r<h.length;r++){var t=h[r];"mutation"===t.kind&&e.push({query:g(t.query),variables:t.variables})}o.writeMetadata(e)},O=!1,b=function(){if(!O){O=!0;for(var e=0;e<h.length;e++){var r=h[e];"mutation"===r.kind&&p(n("teardown",r))}for(var t=0;t<h.length;t++)s.reexecuteOperation(h[t]);h.length=0,O=!1,k()}};o.onOnline(b),o.readMetadata().then((function(e){if(e){for(var t=0;t<e.length;t++)h.push(s.createRequestOperation("mutation",r(e[t].query,e[t].variables)));b()}}));var q=Ge(e)({client:s,dispatchDebug:l,forward:function(e){return d((function(e){return"mutation"===e.operation.kind&&Ve(e.error)&&function(e,r){for(var t,n=r.variables||B(),i=M(r.query),a=[].concat(w(T(r.query)));t=a.pop();)if(L(t,n))if(N(t)){if(e[_(t)])return!0}else{var o=E(t)?t:i[_(t)];o&&a.push.apply(a,w(o))}return!1}(m,e.operation)?(h.push(K.get(e.operation.context._instance)||e.operation),k(),!1):("mutation"!==e.operation.kind||e.error||K.delete(e.operation.context._instance),!0)}))(u(e))}}),K=new WeakMap;return function(e){var r=i(y((function(e){"mutation"===e.kind&&K.set(e.context._instance,e)}))(e)),t=a([c,r]);return d((function(e){return"query"!==e.operation.kind||!Ve(e.error)||(p(Be(e.operation,"cache-only")),h.push(e.operation),!1)}))(q(t))}}return Ge(e)(t)}}Ie.prototype.keyOfEntity=function(e){return be.current&&e===be.current.parent?be.current.parentKey:null==e||"string"==typeof e?e||null:e.__typename?this.rootNames[e.__typename]?e.__typename:(this.keys[e.__typename]?r=this.keys[e.__typename](e):null!=e.id?r=""+e.id:null!=e._id&&(r=""+e._id),r?e.__typename+":"+r:null):null;var r},Ie.prototype.resolve=function(e,r,t){var n=R(r,t),i=this.keyOfEntity(e);if(!i)return null;var a=pe(i,n);return void 0!==a?a:ve(i,n)||null},Ie.prototype.invalidate=function(e,r,t){var n=this.keyOfEntity(e);S(n,"",19),function(e,r,t){for(var n=r?[{fieldKey:R(r,t)}]:Oe(e),i=0,a=n.length;i<a;i++){var o=n[i].fieldKey;void 0!==ve(e,o)?me(e,o,void 0):ye(e,o,void 0)}}(n,r,t)},Ie.prototype.inspectFields=function(e){var r=this.keyOfEntity(e);return r?Oe(r):[]},Ie.prototype.updateQuery=function(e,n){var i=r(e.query,e.variables);i.query=t(i.query);var a=n(this.readQuery(i));null!==a&&Me(this,i,a)},Ie.prototype.readQuery=function(e){var n=r(e.query,e.variables);return n.query=t(n.query),De(this,n).data},Ie.prototype.readFragment=function(e,r,n){return function(e,r,t,n){var i=M(r),a=i[Object.keys(i)[0]];if(!a)return null;var o=O(a);"string"==typeof t||t.__typename||(t.__typename=o);var u=e.keyOfEntity(t);return u&&Re(Ne(e,n||{},i,o,u),u,w(a),$())||null}(this,t(e),r,n)},Ie.prototype.writeFragment=function(e,r,n){!function(e,r,t,n){var i=M(r),a=i[Object.keys(i)[0]];if(a){var o=O(a),u=m({},{__typename:o},t),s=e.keyOfEntity(u);s&&Le(Ne(e,n||{},i,o,s,void 0),s,w(a),u)}}(this,t(e),r,n)},Ie.prototype.link=function(e,r,t,n){var i=void 0!==n?t:null,a=void 0!==n?n:t,o=Se(this,e);"string"==typeof o&&me(o,R(r,i),Se(this,a))};export{Ie as Store,Ge as cacheExchange,ze as offlineExchange,Ce as query,Te as write};
//# sourceMappingURL=urql-exchange-graphcache.min.mjs.map
